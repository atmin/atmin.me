---
import type { GetStaticPaths } from 'astro';
import type { ImageMetadata } from 'astro';
import { getCollection } from 'astro:content';

export const getStaticPaths = (async () => {
    const panoramas = await getCollection('pano');
    return panoramas.map(({ id }) => ({ params: { id } }));
}) satisfies GetStaticPaths;

const emptyImage =
    'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==';

const loRes = import.meta.glob<{ default: ImageMetadata }>(
    '/src/data/pano/**/8k.avif'
);
const loResSrc = (id: string) =>
    (loRes[`/src/data/pano/${id}/8k.avif`] ?? (() => emptyImage))();

const hiRes = import.meta.glob<{ default: ImageMetadata }>(
    '/src/data/pano/**/16k.avif'
);
const hiResSrc = (id: string) =>
    (hiRes[`/src/data/pano/${id}/16k.avif`] ?? (() => emptyImage))();

const { id } = Astro.params;

const src = (await hiResSrc(id)).default.src;
---

<style is:inline>
    html,
    body {
        overflow: hidden;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
    }

    pan-oh {
        width: 100%;
        height: 100%;
    }

    @keyframes panorama-tour {
        0% {
            --pan-yaw: 0;
            --pan-pitch: 0;
            --pan-zoom: 1;
        }
        25% {
            --pan-yaw: 90;
            --pan-pitch: 15;
            --pan-zoom: 2;
        }
        50% {
            --pan-yaw: 180;
            --pan-pitch: -15;
            --pan-zoom: 3;
        }
        75% {
            --pan-yaw: 270;
            --pan-pitch: 15;
            --pan-zoom: 2;
        }
        100% {
            --pan-yaw: 360;
            --pan-pitch: 0;
            --pan-zoom: 1;
        }
    }

    .transition {
        animation: panorama-tour 1s;
    }
</style>

<script src="../../components/pan-oh.web"></script>

<pan-oh src={src}></pan-oh>
