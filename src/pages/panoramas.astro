---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";

const panoramas = await getCollection("pano");
const thumbnails = import.meta.glob<{ default: ImageMetadata }>(
  "/src/data/pano/**/thumbnail.jpg"
);
const thumbnailSrc = (id: string) =>
  (
    thumbnails[`/src/data/pano/${id}/thumbnail.jpg`] ??
    (() =>
      "data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==")
  )();
---

<Layout>
  <main>
    <div>
      <a href="/">
        <section class="content-item">
          <picture>
            <img
              src="/public/atmin160.jpg"
              alt="Atanas Minev seen from a drone"
              width={160}
              height={160}
            />
          </picture>
          <p>back</p>
        </section>
      </a>
      {
        panoramas.map((pano) => (
          <a href={`/pano/${pano.id}`}>
            <section class="content-item">
              <picture>
                <Image
                  src={thumbnailSrc(pano.id)}
                  alt={pano.data.title}
                  width={160}
                  height={160}
                />
              </picture>
              <p>{pano.data.title}</p>
            </section>
          </a>
        ))
      }
    </div>
  </main>
</Layout>

<style>
  .content-item {
    display: flex;
    align-items: center;
    margin-bottom: 2em;
  }

  .content-item picture img {
    border-radius: 50%;
    border: 4px solid transparent;
    transition: border-color 0.2s ease;
    margin-right: 1.5em;
  }

  .content-item:hover {
    cursor: pointer;
  }

  .content-item:hover picture > img,
  .content-item:focus picture > img,
  .content-item:active picture > img {
    border-color: #0070f3;
    transition: border-color 1s ease;
  }

  .content-item h2 {
    margin: 0 0 1rem 0;
    font-size: 1.5rem;
  }

  .content-item p {
    margin: 0;
    font-size: 1.25rem;
    line-height: 1.5;
  }
</style>
